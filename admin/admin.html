<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Quáº£n lÃ½ RSVP</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
      .hidden {
        display: none;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 20px;
      }
      th,
      td {
        border: 1px solid #ccc;
        padding: 8px;
      }
      th {
        background-color: #f2f2f2;
      }
    </style>
  </head>
  <body>
    <h2>ğŸ‘¥ Danh sÃ¡ch</h2>
    <button onclick="logout()">ğŸšª ÄÄƒng xuáº¥t</button>

    <form id="rsvpForm">
      <input type="text" id="name" placeholder="TÃªn thiá»‡p" required /><br />
      <input
        type="text"
        id="url"
        placeholder="URL thiá»‡p"
        required
        style="width: 500px"
      /><br />
      <input
        type="text"
        id="img"
        placeholder="HÃ¬nh áº£nh thumbmail"
        required
        style="width: 1000px"
      /><br />
      <button type="submit">ThÃªm má»›i</button>
    </form>

    <table>
      <thead>
        <tr>
          <th>TÃªn thiá»‡p</th>
          <th>URL thiá»‡p</th>
          <th>HÃ¬nh áº£nh thumbmail</th>
          <th>HÃ nh Ä‘á»™ng</th>
        </tr>
      </thead>
      <tbody id="rsvpTableBody"></tbody>
    </table>

    <script src="../js/config.js"></script>
    <script>
      const { createClient } = supabase;
      const supabaseClient = createClient(
        CONFIG.SUPABASE_URL,
        CONFIG.SUPABASE_KEY
      );

      // Náº¿u chÆ°a Ä‘Äƒng nháº­p thÃ¬ quay vá» login
      if (localStorage.getItem("loggedInAdmin") !== "true") {
        window.location.href = "login.html";
      }

      function logout() {
        localStorage.removeItem("loggedInAdmin");
        window.location.href = "login.html";
      }

      document
        .getElementById("rsvpForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const name = document.getElementById("name").value.trim();
          const url = document.getElementById("url").value.trim();
          const img = document.getElementById("img").value.trim();

          const { error } = await supabaseClient
            .from("list_theme")
            .insert([{ name, url, img }]);
          if (error) return alert("âŒ ThÃªm tháº¥t báº¡i: " + error.message);
          e.target.reset();
          loadData();
        });

      async function loadData() {
        const { data, error } = await supabaseClient
          .from("list_theme")
          .select("*")
          .order("id", { ascending: false });
        const tbody = document.getElementById("rsvpTableBody");
        tbody.innerHTML = "";
        if (error) {
          tbody.innerHTML = `<tr><td colspan="3">âš ï¸ Lá»—i táº£i dá»¯ liá»‡u</td></tr>`;
          return;
        }
        data.forEach((item) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
          <td>${item.name}</td>
          <td>${item.url}</td>
          <td>${item.img}</td>
          <td>
            <a href="edit.html?id=${item.id}">âœï¸ Sá»­a</a> |
            <a href="#" onclick="deleteEntry(${item.id}, '${item.name.replace(
            /'/g,
            "\\'"
          )}')">ğŸ—‘ï¸ XoÃ¡</a>
          </td>`;
          tbody.appendChild(tr);
        });
      }

      async function deleteEntry(id, name) {
        if (!confirm("Báº¡n cÃ³ cháº¯c muá»‘n xoÃ¡ " + name + " khÃ´ng ?")) return;

        const { error } = await supabaseClient
          .from("list_theme")
          .delete()
          .eq("id", id);

        if (error) return alert("âŒ XoÃ¡ tháº¥t báº¡i: " + error.message);
        loadData();
      }

      loadData();
    </script>
  </body>
</html>
